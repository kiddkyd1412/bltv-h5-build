import{o as e,c as t,w as a,a as i,b as s,d as o,r as l,F as m,i as d,p as r,g as n}from"./index.7a468d67.js";import{_ as u}from"./my-video-card.911ea294.js";import{r as c}from"./uni-app.es.46949392.js";import{_ as h}from"./plugin-vue_export-helper.21dcd24c.js";var p=h({data(){return{apis:{getUpDynamicVideo:()=>{let e={url:"https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/all",mapQuery:{timezone_offset:-480,type:"video",page:this.page},mapCookies:{SESSDATA:this.loginUser.SESSDATA||""}};return this.page>1&&(e.mapQuery.offset=this.offset),this.PB.apiRoute("/api/bili/base/myHttpGet",e,"POST")}},loginUser:{},page:1,offset:null,listDB:[],hasMore:!0,isLoading:!1,setTimeoutScroll:null}},onLoad(e){this.init()},computed:{loadImg(){return e=>this.PB.loadImg(e)},shortNumForBoFang:()=>e=>e<1e4?e:(e/1e4).toFixed(1)+"万"},methods:{init(){this.loginUser=this.PB.getLoginUser()||{},this.loadData()},loadData(){this.PB.ajax(this.apis.getUpDynamicVideo(),{myComplete:()=>{this.isLoading=!1}}).then((e=>{console.log("getUpDynamicVideo:",e.data),this.listDB=this.listDB.concat(e.data.items),this.hasMore=e.data.has_more,this.offset=e.data.offset}))},onScroll(e){this.setTimeoutScroll&&clearTimeout(this.setTimeoutScroll),this.setTimeoutScroll=setTimeout((()=>{const t=e.target.offsetTop,a=this.$refs.box.$el.scrollHeight;let i=t+this.$refs.box.$el.clientHeight+this.$refs.box.$el.scrollTop+100;console.log(i),i>=a&&(this.PB.toast("滚动到底部啦~"),!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.page++,this.loadData()))}),200)},openDetail(e){this.PB.navigateTo(`/pages/main/video/detail?aid=${e.aid}&bvid=${e.bvid}`)}}},[["render",function(h,p,f,g,y,_){const v=d,S=c(r("my-video-card"),u),D=n;return e(),t(v,{class:"my-wrap"},{default:a((()=>[i(v,{class:"my-title"},{default:a((()=>[s("动态")])),_:1}),i(v,{class:"my-content"},{default:a((()=>[i(v,{ref:"box",class:"my-list-wrap",onScroll:_.onScroll},{default:a((()=>[(e(!0),o(m,null,l(y.listDB,(s=>(e(),t(v,{class:"my-list-item",key:s.modules.module_dynamic.major.archive.aid,onClick:e=>_.openDetail(s.modules.module_dynamic.major.archive)},{default:a((()=>[i(S,{"img-src":s.modules.module_dynamic.major.archive.cover,title:s.modules.module_dynamic.major.archive.title,"up-name":s.modules.module_author.name,"stat-play":s.modules.module_dynamic.major.archive.stat.play,"stat-danmaku":s.modules.module_dynamic.major.archive.stat.danmaku},null,8,["img-src","title","up-name","stat-play","stat-danmaku"])])),_:2},1032,["onClick"])))),128)),i(v,{class:"my-list-tip"},{default:a((()=>[y.hasMore?(e(),t(v,{key:1},{default:a((()=>[i(D,null,{default:a((()=>[s("加载中...")])),_:1})])),_:1})):(e(),t(v,{key:0},{default:a((()=>[i(D,null,{default:a((()=>[s("没有更多数据了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["onScroll"])])),_:1})])),_:1})}],["__scopeId","data-v-6e59b834"]]);export{p as default};
