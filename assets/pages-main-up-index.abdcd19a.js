import{o as t,c as e,w as s,a as i,b as a,d as l,r as o,F as r,i as c,p as d,g as n}from"./index.0acfa85f.js";import{_ as u}from"./my-video-card.48e6a55b.js";import{r as m}from"./uni-app.es.8c874889.js";import{_ as p}from"./plugin-vue_export-helper.21dcd24c.js";var h=p({data(){return{apis:{getUpDynamicVideo:()=>{let t={url:"https://api.bilibili.com/x/space/arc/search",mapQuery:{mid:this.mid,tid:0,ps:30,pn:this.page,order:"pubdate",order_avoided:"true"}};return this.PB.apiRoute("/api/bili/base/myHttpGet",t,"POST")}},mid:null,page:1,count:null,listDB:[],hasMore:!0,isLoading:!1,setTimeoutScroll:null}},onLoad(t){this.mid=t.mid,this.init()},onShow(){this.resetScroll()},computed:{},methods:{init(){this.removeScroll(),this.loadData()},loadData(){this.PB.ajax(this.apis.getUpDynamicVideo(),{myComplete:()=>{this.isLoading=!1}}).then((t=>{console.log("data:",t.data),this.listDB=this.listDB.concat(t.data.list.vlist),this.count=t.data.page.count,this.hasMore=this.listDB.length<this.count}))},onScroll(t){this.setTimeoutScroll&&clearTimeout(this.setTimeoutScroll),this.setTimeoutScroll=setTimeout((()=>{this.updateScroll();const e=t.target.offsetTop,s=this.$refs.box.$el.scrollHeight;let i=e+this.$refs.box.$el.clientHeight+this.$refs.box.$el.scrollTop+100;console.log(i),i>=s&&!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.page++,this.loadData())}),200)},resetScroll(){let t=this.PB.getStorage("up_scroll");t&&this.$nextTick((()=>{document.querySelector(".my-list-wrap").scrollTop=t}));let e=this.PB.getStorage("up_selectItemIndex");e&&this.$nextTick((()=>{document.querySelectorAll(".my-list-item")[e].focus()}))},updateScroll(){this.PB.setStorage("up_scroll",document.querySelector(".my-list-wrap").scrollTop)},removeScroll(){this.PB.removeStorage("up_selectItemIndex"),this.PB.removeStorage("up_scroll")},openDetail(t,e){this.PB.setStorage("up_selectItemIndex",e),this.PB.navigateTo(`/pages/main/video/detail?aid=${t.aid}&bvid=${t.bvid}`)}}},[["render",function(p,h,g,f,y,S){const _=c,v=m(d("my-video-card"),u),b=n;return t(),e(_,{class:"my-wrap"},{default:s((()=>[i(_,{class:"my-title"},{default:s((()=>[a("视频投稿")])),_:1}),i(_,{class:"my-content"},{default:s((()=>[i(_,{ref:"box",class:"my-list-wrap g-tabindex-noborder",onScroll:S.onScroll},{default:s((()=>[(t(!0),l(r,null,o(y.listDB,((a,l)=>(t(),e(_,{class:"my-list-item g-tabindex-noscale",key:a.aid,onClick:t=>S.openDetail(a,l)},{default:s((()=>[i(v,{"img-src":a.pic,title:a.title,"stat-play":a.play,"stat-danmaku":a.video_review,created:1e3*a.created},null,8,["img-src","title","stat-play","stat-danmaku","created"])])),_:2},1032,["onClick"])))),128)),i(_,{class:"my-list-tip"},{default:s((()=>[y.hasMore?(t(),e(_,{key:1},{default:s((()=>[i(b,null,{default:s((()=>[a("加载中...")])),_:1})])),_:1})):(t(),e(_,{key:0},{default:s((()=>[i(b,null,{default:s((()=>[a("没有更多数据了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["onScroll"])])),_:1})])),_:1})}],["__scopeId","data-v-2969cf2c"]]);export{h as default};
