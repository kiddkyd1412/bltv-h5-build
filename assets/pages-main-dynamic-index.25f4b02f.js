import{o as t,c as e,w as a,a as i,b as s,d as o,r as l,F as d,i as m,p as r,g as n}from"./index.6a69d336.js";import{_ as c}from"./my-video-card.5f11d300.js";import{r as u}from"./uni-app.es.c55df1fc.js";import{_ as h}from"./plugin-vue_export-helper.21dcd24c.js";var p=h({data(){return{apis:{getUpDynamicVideo:()=>{let t={url:"https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/all",mapQuery:{timezone_offset:-480,type:"video",page:this.page},mapCookies:{SESSDATA:this.loginUser.SESSDATA||""}};return this.page>1&&(t.mapQuery.offset=this.offset),this.PB.apiRoute("/api/bili/base/myHttpGet",t,"POST")}},loginUser:{},page:1,offset:null,listDB:[],hasMore:!0,isLoading:!1,setTimeoutScroll:null}},onLoad(t){this.init()},computed:{loadImg(){return t=>this.PB.loadImg(t)},shortNumForBoFang:()=>t=>t<1e4?t:(t/1e4).toFixed(1)+"万"},methods:{init(){this.loginUser=this.PB.getLoginUser()||{},this.loadData()},loadData(){this.PB.ajax(this.apis.getUpDynamicVideo(),{myComplete:()=>{this.isLoading=!1}}).then((t=>{console.log("getUpDynamicVideo:",t.data),this.listDB=this.listDB.concat(t.data.items),this.hasMore=t.data.has_more,this.offset=t.data.offset}))},onScroll(t){this.setTimeoutScroll&&clearTimeout(this.setTimeoutScroll),this.setTimeoutScroll=setTimeout((()=>{const e=t.target.offsetTop,a=this.$refs.box.$el.scrollHeight;let i=e+this.$refs.box.$el.clientHeight+this.$refs.box.$el.scrollTop+100;console.log(i),i>=a&&(this.PB.toast("滚动到底部啦~"),!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.page++,this.loadData()))}),200)},openDetail(t){this.PB.navigateTo(`/pages/main/video/detail?aid=${t.aid}&bvid=${t.bvid}`)}}},[["render",function(h,p,f,g,y,_){const v=m,S=u(r("my-video-card"),c),D=n;return t(),e(v,{class:"my-wrap"},{default:a((()=>[i(v,{class:"my-title"},{default:a((()=>[s("动态")])),_:1}),i(v,{class:"my-content"},{default:a((()=>[i(v,{ref:"box",class:"my-list-wrap",onScroll:_.onScroll},{default:a((()=>[(t(!0),o(d,null,l(y.listDB,(s=>(t(),e(v,{class:"my-list-item",key:s.modules.module_dynamic.major.archive.aid,onClick:t=>_.openDetail(s.modules.module_dynamic.major.archive)},{default:a((()=>[i(S,{"img-src":s.modules.module_dynamic.major.archive.cover,title:s.modules.module_dynamic.major.archive.title,"up-name":s.modules.module_author.name,"stat-play":s.modules.module_dynamic.major.archive.stat.play,"stat-danmaku":s.modules.module_dynamic.major.archive.stat.danmaku},null,8,["img-src","title","up-name","stat-play","stat-danmaku"])])),_:2},1032,["onClick"])))),128)),i(v,{class:"my-list-tip"},{default:a((()=>[y.hasMore?(t(),e(v,{key:1},{default:a((()=>[i(D,null,{default:a((()=>[s("加载中...")])),_:1})])),_:1})):(t(),e(v,{key:0},{default:a((()=>[i(D,null,{default:a((()=>[s("没有更多数据了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["onScroll"])])),_:1})])),_:1})}],["__scopeId","data-v-6e59b834"]]);export{p as default};
