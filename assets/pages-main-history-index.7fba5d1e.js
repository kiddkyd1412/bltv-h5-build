import{o as t,c as e,w as s,a as i,b as o,d as a,r as l,F as r,i as n,p as c,g as h}from"./index.0acfa85f.js";import{_ as d}from"./my-video-card.48e6a55b.js";import{r as u}from"./uni-app.es.8c874889.js";import{_ as m}from"./plugin-vue_export-helper.21dcd24c.js";var p=m({data(){return{apis:{getList:()=>{let t={url:"https://api.bilibili.com/x/web-interface/history/cursor",mapQuery:{type:"archive",business:"archive",ps:20},mapCookies:{SESSDATA:this.loginUser.SESSDATA||""}};return this.nextMax>0&&(t.mapQuery.view_at=this.nextViewAt,t.mapQuery.max=this.nextMax),this.PB.apiRoute("/api/bili/base/myHttpGet",t,"POST")}},loginUser:{},nextViewAt:null,nextMax:null,listDB:[],hasMore:!0,isLoading:!1,setTimeoutScroll:null}},onLoad(t){this.init()},onShow(){this.resetScroll()},computed:{},methods:{init(){this.loginUser=this.PB.getLoginUser()||{},this.removeScroll(),this.loadData()},loadData(){this.PB.ajax(this.apis.getList(),{myComplete:()=>{this.isLoading=!1}}).then((t=>{console.log("getList:",t.data),this.listDB=this.listDB.concat(t.data.list),this.hasMore=t.data.cursor.max>0,this.nextMax=t.data.cursor.max,this.nextViewAt=t.data.cursor.view_at}))},onScroll(t){this.setTimeoutScroll&&clearTimeout(this.setTimeoutScroll),this.setTimeoutScroll=setTimeout((()=>{this.updateScroll();const e=t.target.offsetTop,s=this.$refs.box.$el.scrollHeight;let i=e+this.$refs.box.$el.clientHeight+this.$refs.box.$el.scrollTop+100;console.log(i),i>=s&&!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.loadData())}),200)},resetScroll(){let t=this.PB.getStorage("history_scroll");t&&this.$nextTick((()=>{document.querySelector(".my-list-wrap").scrollTop=t}));let e=this.PB.getStorage("history_selectItemIndex");e&&this.$nextTick((()=>{document.querySelectorAll(".my-list-item")[e].focus()}))},updateScroll(){this.PB.setStorage("history_scroll",document.querySelector(".my-list-wrap").scrollTop)},removeScroll(){this.PB.removeStorage("history_selectItemIndex"),this.PB.removeStorage("history_scroll")},openDetail(t,e){this.PB.setStorage("history_selectItemIndex",e),this.PB.navigateTo(`/pages/main/video/detail?aid=${t.kid}&bvid=${t.history.bvid}`)}}},[["render",function(m,p,g,y,S,x){const f=n,_=u(c("my-video-card"),d),v=h;return t(),e(f,{class:"my-wrap"},{default:s((()=>[i(f,{class:"my-title"},{default:s((()=>[o("历史")])),_:1}),i(f,{class:"my-content"},{default:s((()=>[i(f,{ref:"box",class:"my-list-wrap g-tabindex-noborder",onScroll:x.onScroll},{default:s((()=>[(t(!0),a(r,null,l(S.listDB,((o,a)=>(t(),e(f,{class:"my-list-item g-tabindex-noscale",key:o.history.cid,onClick:t=>x.openDetail(o,a)},{default:s((()=>[i(_,{"img-src":o.cover,title:o.title,"up-name":o.author_name,duration:o.duration},null,8,["img-src","title","up-name","duration"])])),_:2},1032,["onClick"])))),128)),i(f,{class:"my-list-tip"},{default:s((()=>[S.hasMore?(t(),e(f,{key:1},{default:s((()=>[i(v,null,{default:s((()=>[o("加载中...")])),_:1})])),_:1})):(t(),e(f,{key:0},{default:s((()=>[i(v,null,{default:s((()=>[o("没有更多数据了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["onScroll"])])),_:1})])),_:1})}],["__scopeId","data-v-6ef0d650"]]);export{p as default};
