import{o as e,c as t,w as a,a as s,b as o,d as i,r as l,F as r,i as m,p as d,g as c}from"./index.6293db25.js";import{_ as n}from"./my-video-card.696f9e15.js";import{r as u}from"./uni-app.es.232ee89d.js";import{_ as h}from"./plugin-vue_export-helper.21dcd24c.js";var p=h({data(){return{apis:{getUpDynamicVideo:()=>{let e={url:"https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/all",mapQuery:{timezone_offset:-480,type:"video",page:this.page},mapCookies:{SESSDATA:this.loginUser.SESSDATA||""}};return this.page>1&&(e.mapQuery.offset=this.offset),this.PB.apiRoute("/api/bili/base/myHttpGet",e,"POST")}},loginUser:{},page:1,offset:null,listDB:[],hasMore:!0,isLoading:!1,setTimeoutScroll:null}},onLoad(e){this.init()},onShow(){this.resetScroll()},computed:{},methods:{init(){this.loginUser=this.PB.getLoginUser()||{},this.removeScroll(),this.loadData()},loadData(){this.PB.ajax(this.apis.getUpDynamicVideo(),{myComplete:()=>{this.isLoading=!1}}).then((e=>{console.log("getUpDynamicVideo:",e.data),this.listDB=this.listDB.concat(e.data.items),this.hasMore=e.data.has_more,this.offset=e.data.offset}))},onScroll(e){this.setTimeoutScroll&&clearTimeout(this.setTimeoutScroll),this.setTimeoutScroll=setTimeout((()=>{this.updateScroll();const t=e.target.offsetTop,a=this.$refs.box.$el.scrollHeight;let s=t+this.$refs.box.$el.clientHeight+this.$refs.box.$el.scrollTop+100;console.log(s),s>=a&&!this.isLoading&&this.hasMore&&(this.isLoading=!0,this.page++,this.loadData())}),200)},resetScroll(){let e=this.PB.getStorage("dynamic_scroll");e&&this.$nextTick((()=>{document.querySelector(".my-list-wrap").scrollTop=e}));let t=this.PB.getStorage("dynamic_selectItemIndex");t&&this.$nextTick((()=>{document.querySelectorAll(".my-list-item")[t].focus()}))},updateScroll(){this.PB.setStorage("dynamic_scroll",document.querySelector(".my-list-wrap").scrollTop)},removeScroll(){this.PB.removeStorage("dynamic_selectItemIndex"),this.PB.removeStorage("dynamic_scroll")},openDetail(e,t){this.PB.setStorage("dynamic_selectItemIndex",t),this.PB.navigateTo(`/pages/main/video/detail?aid=${e.aid}&bvid=${e.bvid}`)}}},[["render",function(h,p,y,g,f,S){const _=m,v=u(d("my-video-card"),n),b=c;return e(),t(_,{class:"my-wrap"},{default:a((()=>[s(_,{class:"my-title"},{default:a((()=>[o("动态")])),_:1}),s(_,{class:"my-content"},{default:a((()=>[s(_,{ref:"box",class:"my-list-wrap g-tabindex-noborder",onScroll:S.onScroll},{default:a((()=>[(e(!0),i(r,null,l(f.listDB,((o,i)=>(e(),t(_,{class:"my-list-item g-tabindex-noscale",key:o.modules.module_dynamic.major.archive.aid,onClick:e=>S.openDetail(o.modules.module_dynamic.major.archive,i)},{default:a((()=>[s(v,{"img-src":o.modules.module_dynamic.major.archive.cover,title:o.modules.module_dynamic.major.archive.title,"up-name":o.modules.module_author.name,"stat-play":o.modules.module_dynamic.major.archive.stat.play,"stat-danmaku":o.modules.module_dynamic.major.archive.stat.danmaku},null,8,["img-src","title","up-name","stat-play","stat-danmaku"])])),_:2},1032,["onClick"])))),128)),s(_,{class:"my-list-tip"},{default:a((()=>[f.hasMore?(e(),t(_,{key:1},{default:a((()=>[s(b,null,{default:a((()=>[o("加载中...")])),_:1})])),_:1})):(e(),t(_,{key:0},{default:a((()=>[s(b,null,{default:a((()=>[o("没有更多数据了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["onScroll"])])),_:1})])),_:1})}],["__scopeId","data-v-567a2458"]]);export{p as default};
